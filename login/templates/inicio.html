<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous">
    <style type="text/css">

    body{
        font-family:Arial, Helvetica, sans-serif;
        margin:0;
        height: 100vh;
        
      }

    .navbar {
        display:flex;
        flex-direction: column;
        align-items: flex-start;
        width: 200px;
        background-color: #1e1e1e;
        padding:20px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        border-top-right-radius: 5px;
        position:relative;
        
      }

      .link-login{
        position: absolute;
        bottom:20px;
        left:10px;
        color: #fff;
        text-decoration:none;
        margin-right: 10px;
        color:#fff;
        font-size: 20px;
      }

      .navbar ul{
        margin:0;
        padding: 0;
        list-style: none;
        
      }

      .navbar ul li{
        border-bottom:1px solid #1e1e1e;
        display: flex;
        align-items: center;
        margin-top:10px;
      }
      .navbar i{
        margin-right: 10px;
        color: #fff;
      }

      .navbar ul a{
        box-sizing: border-box;
        color:white;
        display: block;
        width: 100%;
        padding: 6px 10px;
        margin: 5px 0;
        text-decoration: none;

      }


      .navbar a{
        color: white;
        text-align: left;
        padding: 12px;
        text-decoration:none;
      }

      .title-navbar {
        display: flex;
        align-items: center;
        margin-bottom:20px;
      }
      .title-navbar i{
        margin-right: 10px;
        color:#fff;
        font-size: 30px;
      }

      .title-navbar h4{
        color:#fff;
        margin:0;
      }

      .container-home{
        display: flex;
        min-height: 100vh;
        margin: 0;
        gap: 30px;
        font-family:Arial;
        margin-top:80px;

        
      }

      .dashboard{
        flex-wrap: wrap;
        justify-content:space-around;
        display: flex;
        padding-top: 20px;

        
      }

      .dashboard-item{
        flex:0 0 calc(33.33% -40px);
        margin:20px;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        background-color: #fff;
        transition: transform 0.3s ease-in-out;
        overflow:hidden;
        text-align: center;
        display: flex;
        flex-direction:column;
        align-items: center;
      }

      .dashboard-item:hover {
      transform: scale(1.05);
     }
     .total-ot-container {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
}

      .dashboard-item h2{
        color:#333;
        margin-bottom:10px;
        font-size: 1.5em;
      }
      .dashboard-item canvas {
        width: 100%;
        height: 100%;
        display: block;
        border: 1px solid #ddd;
        border-radius: 8px;
    }

      .dashboard-item p {
        color:#555;
        margin: 0;
        font-size: 20px;
        
      }

      .dashboard-item ul{
        list-style-type:none;
        padding:0;
        margin:0;
      }

      .dashboard-item ul li {
        border-bottom: 1px solid #ddd;
        padding:10px;
        font-size:16px;
        color:#333;
      }

      .dashboard-item ul li:last-child{
        border-bottom: none;
      }
      .dashboard-item li {
        color: #555;
        font-size: 16px;
}

.dark-card {
    background-color: #333;  
    color: #fff;
    border-radius: 10px;  
    padding: 20px; 
    
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);  
    transition: background-color 0.3s ease-in-out;  
    height: 100px;
    width: 300px;
}
.dark-card h2 {
    color: #fff;
}

.dark-card p{
    color: #fff;
}

.dark-card:hover {
    background-color: #555;  
}

.usuarios{
    background-color: #333;  
    color: #fff;
    border-radius: 10px;  
    padding: 20px; 
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);  
    transition: background-color 0.3s ease-in-out;  
    height: 200px;
    width: 400px;
}

.usuarios h2 {
    color: #fff;
}

.usuarios p{
    color: #fff;
}

.dark-card:hover {
    background-color: #555;  
}

.ultimos{
    background-color: #333;  
    color: #fff;
    border-radius: 10px;  
    padding: 20px; 
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);  
    transition: background-color 0.3s ease-in-out; 
    width: 400px;
}

.ultimos h2 {
    color: #fff;
}

.ultimos .liultimos{
    color: #fff;
    font-size: 16px;
    padding: 10px;
    border-bottom: 1px solid #ddd;
}

.dark-card:hover {
    background-color: #555;  
}

.dashboard-row{
    display:flex;
    justify-content: space-between;
    margin-top: 20px;
    
}

.dashboard-item{
    flex: 0 0 calc(50% -20px);
    margin:10px;
}

.dark-card{
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.grafico{
    background-color: #333;  
    color: #fff;
    border-radius: 10px;  
    padding: 20px; 
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);  
    transition: background-color 0.3s ease-in-out; 
    width: 400px;

}

.grafico h2{
    color: #fff;
}

.navbar-horizontal{
  position: fixed;
  top:0;
  left:0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color:#0b1e5e;
  padding: 15px 20px;
  width: 1305px;
  color: #fff;
  z-index:1000;
  margin-bottom: 20px;
  box-shadow: 0 2px 5px rgba(66, 7, 194, 0.1);
  
}

.user{
  color:#fff;
  margin-right: 650px;
  font-size: 16px;
  margin-left: 8px;
}

.container-total-ot{
  margin-top: 20px;
}

.total-registros-usuario{
  margin-left: 8px;
  color: #fff;
  font-size: 16px;
  margin-right: 100px;
  
}

.usuario-info{
  display:flex;
  align-items: center;
}

.fecha-ultimo-registro{
  margin-left: 5px;
}

.title{
  color: #333;
    margin-bottom: 10px;
    font-size: 1.5em;
    border-bottom: 5px solid #0b1e5e;
    display: inline-block;
}

@media screen and (max-width: 768px) {
    .container-home {
        grid-template-columns: 1fr;
    }

    .dashboard {
        grid-template-columns: 1fr;
    }
}

.dashboard-item:hover {
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
}










      </style>
</head>


<body>
  <div class="navbar-horizontal">
    
    <div class="usuario-info">
    {% if nombre and apellido %}
    <i class='bx bx-user-circle'></i>
    <p class="user">{{nombre}} {{apellido}}</p>
        {% if user.userprofile.foto %}
            <img src="{{ user.userprofile.foto.url }}" alt="Foto de perfil">
        {% endif %}
    </div>
    {% endif%}

    <i class='bx bx-bar-chart-alt-2'></i>
    <div class="total-registros-info">
    {% if total_registros_usuario %}
        <p class="total-registros-usuario">Total de Registros: {{ total_registros_usuario }}</p>
{% endif %}
</div>



<i class='bx bx-time'></i>
<div class="registro-info">
  {% if fecha_ultimo_registro %}
      <p class="fecha-ultimo-registro">Último Registro: {{ fecha_ultimo_registro|date:"d/m/Y" }}</p>
  {% endif %}
</div>
</div>
</div>

    <div class="container-home">
     
      

  
        <div class="navbar">

         <div class="title-navbar">
           <i class='bx bxl-magento'></i><a href="{% url 'iniciar' %}"><h4>Magento</h4></a>
         </div>

         <ul>
           <li>
             <i class='bx bx-home-alt-2'></i><a href="{% url 'inicio' %}">Inicio</a>
           </li>
           <li>
             <i class='bx bxs-report'></i><a href="{% url 'home' %}">Nueva OT</a>
           </li>
           <li>
             <i class='bx bxs-data'></i><a href="{% url 'listado' %}">Informe</a>
           </li>

           {% if user.is_staff %}
            <li>
                <i class ='bx bx-user'></i><a href="{% url 'registro' %}">Usuarios</a>
             </li>
            {% endif %}
         </ul>
         <div class="link-login">  
            <a href="../salir/"><i class='bx bx-right-arrow-alt'></i>Salir</a>
          </div>

        </div>

        <div class="dashboard">
          

        

         <div class="dashboard-item dark-card">
            <i class="fas fa-database fa-2x"></i>
            <h2 class="title">Total de OT</h2>
            <p>{{ total_registros_count }}</p>
         </div>

         
         <div class="dashboard-row">
         <div class="dashboard-item usuarios">
            <i class="fas fa-trophy fa-2x"></i>
            <h2 class="title">Usuario con más Registros</h2>
            {% if trabajador_con_mas_registros %}
                <p>Usuario: {{trabajador_con_mas_registros.user__username }}</p>
                <p>Número de Registros: {{trabajador_con_mas_registros.registros }}</p>
            {% else %}
                <p>No hay trabajadores con registros este mes</p>
            {% endif %}
         </div>

            
         <div class="dashboard-item usuarios">
            <i class="fas fa-long-arrow-alt-down fa-2x"></i>
            <h2 class="title">Usuario con menos Registros</h2>
                <p>Usuario: {{registros_menos_por_mes.user__username }}</p>
                <p>Número de Registros: {{registros_menos_por_mes.registros}}</p>
         </div>
         </div>

         <div class="dashboard-row">
         <div class="dashboard-item ultimos">
            <i class="fas fa-users fa-2x"></i>
            <h2 class="title">Últimos Usuarios Registrados</h2>
            <ul>
            {% for usuario in usuarios_registrados %}
            <li class="liultimos"> {{usuario}}</li>
            {% endfor %}
            </ul>
        </div>

         <div class="dashboard-item grafico">
            <h2 class="title">Registros por Mes</h2>
            <canvas id="regPorMesChart" width="400" height="200"></canvas>
         </div>

        </div>
        </div>


    </div>
<script>

        var currentDate= new Date();
        var currentMonth = currentDate.getMonth();
        var months =["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];
        
        var labels= months.slice(currentMonth).concat(months.slice(0, currentMonth))
        var registrosPorMesData = {
           labels: labels,
           datasets: [{
              label: 'Registros por Mes',
              data:JSON.parse('{{ data | safe}}'),
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1
           }]
        };
  
        var regPorMesChart = new Chart(document.getElementById('regPorMesChart'), {
           type: 'bar',
           data: registrosPorMesData,
          
        });




        


</script>


    
</body>
</html>